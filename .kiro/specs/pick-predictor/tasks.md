# Implementation Plan: Pick Predictor System

- [x] 1. Создать модели данных для системы предсказаний





  - Создать PredictorMatch модель с полями для команд, логотипов, времени начала, статуса и результатов драфта
  - Создать PredictorBet модель для хранения ставок пользователей с предсказаниями и наградами
  - Создать Notification модель для уведомлений с TTL индексом для автоудаления через 30 дней
  - Добавить индексы для оптимизации запросов (startTime, status, userId, matchId)
  - _Requirements: 1.1, 1.2, 2.1, 2.5, 3.4, 5.1, 5.5, 6.1, 6.2, 9.1, 9.2, 9.5_

- [x] 2. Реализовать backend сервисы для обработки предсказаний





  - Создать PredictionService с методами для расчета коэффициентов, валидации ставок и распределения наград
  - Реализовать метод calculateOdds для динамического расчета коэффициентов на основе распределения ставок
  - Реализовать метод placeBet для размещения ставки с проверкой баланса и списанием монет
  - Реализовать метод processResults для обработки результатов драфта и определения победителей
  - Реализовать метод distributeRewards для начисления наград пропорционально ставкам
  - Добавить метод closeBetting для автоматического закрытия приема ставок за 5 минут до матча
  - _Requirements: 2.1, 2.2, 2.5, 3.1, 3.2, 3.3, 3.4, 4.2, 5.1, 5.2, 5.3, 5.4, 5.5, 7.5_

- [x] 3. Создать NotificationService для управления уведомлениями





  - Реализовать метод sendMatchStartingNotification для уведомлений за 10 минут до начала матча
  - Реализовать метод sendPredictionResultNotification для уведомлений о результатах предсказаний
  - Реализовать метод scheduleMatchNotifications для планирования уведомлений
  - Добавить метод cleanupExpiredNotifications для очистки старых уведомлений
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 4. Реализовать API endpoints для матчей





  - Создать GET /api/predictor/matches для получения списка доступных матчей с фильтрацией по статусу
  - Создать GET /api/predictor/matches/:id для получения деталей конкретного матча
  - Создать POST /api/predictor/matches для создания нового матча (только admin)
  - Создать PUT /api/predictor/matches/:id для обновления данных матча (только admin)
  - Создать DELETE /api/predictor/matches/:id для удаления матча (только admin)
  - Создать POST /api/predictor/matches/:id/results для установки результатов драфта (только admin)
  - Добавить middleware для проверки роли администратора
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 7.1, 7.2, 7.3, 7.4_

- [x] 5. Реализовать загрузку логотипов команд





  - Настроить Multer для обработки загрузки файлов с ограничением размера 2 МБ
  - Создать POST /api/predictor/matches/:id/logo endpoint для загрузки логотипов
  - Добавить валидацию формата файлов (PNG, JPG, JPEG, SVG)
  - Реализовать сохранение файлов в директорию uploads/team-logos
  - Добавить обработку ошибок при неверном формате или превышении размера
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7_

- [x] 6. Реализовать API endpoints для ставок





  - Создать POST /api/predictor/bets для размещения ставки с валидацией баланса
  - Создать GET /api/predictor/bets для получения всех ставок текущего пользователя
  - Создать GET /api/predictor/bets/:id для получения деталей конкретной ставки
  - Добавить проверку диапазона ставки (10-10000 монет)
  - Интегрировать с PredictionService для обработки ставок
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4_

- [x] 7. Реализовать API endpoints для статистики и истории





  - Создать GET /api/predictor/stats/:matchId для получения статистики ставок по матчу
  - Реализовать расчет процентного распределения ставок между вариантами
  - Создать GET /api/predictor/history для получения истории предсказаний пользователя
  - Добавить фильтрацию истории по игре, дате и статусу
  - Реализовать пагинацию для истории (20 записей на страницу)
  - Добавить расчет общей статистики пользователя (процент успеха, выигрыш/проигрыш)
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 8. Реализовать API endpoints для уведомлений





  - Создать GET /api/predictor/notifications для получения уведомлений пользователя
  - Создать PUT /api/predictor/notifications/:id для отметки уведомления как прочитанного
  - Добавить пагинацию для уведомлений (50 записей на страницу)
  - Реализовать фильтрацию непрочитанных уведомлений
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 9. Зарегистрировать predictor routes в server.js





  - Добавить app.use('/api/predictor', require('./routes/predictorRoutes')) в server.js
  - Убедиться, что роут подключен после middleware для аутентификации
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 6.1, 7.1, 9.1_

- [x] 10. Создать главную страницу PredictorPage





  - Создать компонент PredictorPage с навигацией и списком матчей
  - Реализовать получение списка матчей через API
  - Добавить фильтры по игре (Dota 2 / CS2)
  - Реализовать сортировку матчей по времени начала
  - Добавить индикатор "Скоро начнется" для матчей за 10 минут до начала
  - Создать CSS стили для страницы
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 11. Создать компонент MatchCard для отображения матча





  - Создать компонент MatchCard с отображением логотипов команд
  - Добавить отображение названий команд, времени начала и игры
  - Реализовать отображение статуса матча
  - Добавить обработчик клика для навигации к деталям матча
  - Создать CSS стили для карточки матча
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 8.6_

- [x] 12. Создать страницу деталей матча PredictorMatchPage





  - Создать компонент PredictorMatchPage для отображения деталей матча
  - Реализовать получение данных матча через API
  - Добавить отображение информации о командах с логотипами
  - Реализовать отображение доступных типов предсказаний
  - Добавить таймер до закрытия приема ставок
  - Создать CSS стили для страницы
  - _Requirements: 2.1, 2.2, 8.6_

- [x] 13. Создать компонент PredictionForm для размещения ставок





  - Создать компонент PredictionForm с выбором варианта предсказания
  - Добавить поле ввода суммы ставки с валидацией (10-10000)
  - Реализовать отображение текущего коэффициента
  - Добавить расчет и отображение потенциального выигрыша
  - Реализовать отправку ставки через API
  - Добавить обработку ошибок (недостаточно средств, ставки закрыты)
  - Создать CSS стили для формы
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 4.2_

- [x] 14. Создать компонент PredictionStats для статистики





  - Создать компонент PredictionStats для отображения статистики ставок
  - Реализовать получение статистики через API
  - Добавить отображение процентного распределения ставок
  - Реализовать отображение количества участников и размера пула наград
  - Добавить автообновление статистики каждые 10 секунд
  - Создать CSS стили для компонента статистики
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 15. Создать страницу истории PredictorHistoryPage





  - Создать компонент PredictorHistoryPage для отображения истории предсказаний
  - Реализовать получение истории через API с пагинацией
  - Добавить фильтры по игре, дате и статусу
  - Реализовать отображение общей статистики пользователя
  - Добавить сортировку по дате в порядке убывания
  - Создать CSS стили для страницы истории
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 16. Создать компонент BetHistoryCard для истории ставок



  - Создать компонент BetHistoryCard для отображения одной ставки
  - Добавить отображение информации о матче (команды, время)
  - Реализовать отображение сделанных предсказаний и размеров ставок
  - Добавить отображение результата (выигрыш/проигрыш) с цветовой индикацией
  - Реализовать отображение суммы выигрыша
  - Создать CSS стили для карточки истории
  - _Requirements: 6.2, 6.3_

- [x] 17. Создать компонент NotificationBell для уведомлений





  - Создать компонент NotificationBell с иконкой и счетчиком непрочитанных
  - Реализовать получение уведомлений через API
  - Добавить выпадающий список уведомлений при клике
  - Реализовать отметку уведомления как прочитанного
  - Добавить автообновление уведомлений каждые 30 секунд
  - Создать CSS стили для компонента уведомлений
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 18. Создать административную панель AdminPredictorPanel





  - Создать компонент AdminPredictorPanel для управления матчами
  - Реализовать форму создания нового матча с выбором игры и команд
  - Добавить загрузку логотипов команд через input type="file"
  - Реализовать настройку типов предсказаний и доступных вариантов
  - Добавить форму для установки результатов драфта
  - Реализовать просмотр статистики ставок по матчу
  - Создать CSS стили для административной панели
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7_

- [x] 19. Добавить роуты в React Router





  - Добавить роут /predictor для главной страницы предсказаний
  - Добавить роут /predictor/match/:id для страницы деталей матча
  - Добавить роут /predictor/history для страницы истории
  - Добавить роут /admin/predictor для административной панели (только для admin)
  - Обновить навигационное меню с добавлением ссылки на предсказания
  - _Requirements: 1.1, 2.1, 6.1, 7.1_

- [x] 20. Интегрировать систему уведомлений в приложение





  - Добавить компонент NotificationBell в главный layout приложения
  - Реализовать контекст для управления уведомлениями
  - Добавить toast-уведомления для важных событий (ставка принята, результаты готовы)
  - Интегрировать с существующей системой аутентификации
  - _Requirements: 9.1, 9.2, 9.3, 9.4_

- [x] 21. Добавить обработку ошибок и валидацию





  - Реализовать централизованную обработку ошибок API на frontend
  - Добавить toast-уведомления для всех типов ошибок
  - Реализовать валидацию форм на клиенте перед отправкой
  - Добавить retry-кнопку при ошибках сети
  - Реализовать graceful degradation при недоступности API
  - _Requirements: 3.3, 8.4_

- [x] 22. Написать тесты для backend





  - Написать unit тесты для PredictionService (расчет коэффициентов, распределение наград)
  - Написать unit тесты для NotificationService
  - Написать integration тесты для API endpoints
  - Написать тесты для загрузки файлов логотипов
  - Добавить тесты для валидации моделей Mongoose
  - _Requirements: 2.1, 3.1, 5.1, 8.1_

- [x] 23. Написать тесты для frontend компонентов




  - Написать тесты для PredictorPage (рендеринг списка матчей)
  - Написать тесты для PredictionForm (валидация, отправка)
  - Написать тесты для PredictionStats (отображение статистики)
  - Написать тесты для NotificationBell (получение и отметка уведомлений)
  - Написать тесты для AdminPredictorPanel (создание матча, загрузка логотипов)
  - _Requirements: 1.1, 2.1, 4.1, 7.1, 9.1_

- [x] 24. Настроить переменные окружения и деплой





  - Добавить переменные окружения для настройки системы предсказаний
  - Настроить директорию для хранения логотипов команд
  - Добавить миграцию для создания индексов в MongoDB
  - Обновить документацию по развертыванию
  - _Requirements: 8.5_
